<!-- This file is an example of what a configuration overrides file might
	look like. It contains most of the common overrides that one might want but
	is essentially the defaults in the different config files so it is not needed
	See the javadocs of jeeves.server.ConfigurationOverrides for the complete
	set of options that can be used in an overrides file The javadocs also explain
	how to configure which override file is used in a particular environement.
	A original proposal about the overrides are at: http://trac.osgeo.org/geonetwork/wiki/ConfigOverride
	The API has changed slightly since it was written but the principals remain
	the same -->
<overrides xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:noNamespaceSchemaLocation="config-overrides.xsd" xmlns:sec="http://www.springframework.org/schema/security">
	<!-- an import can be used if many of the overrides are common between your
		different configurations -->
	<import file="/WEB-INF/server-props-overrides.xml" />

    <file name=".*/WEB-INF/config-db.xml">
        <addXML xpath="data">
			<file path="WEB-INF/classes/setup/sql/data" filePrefix="settings-swe-"/>
		</addXML>
    </file>

	<file name=".*/WEB-INF/config.xml">

		<replaceText xpath="general/uploadDir">${gn.path}/data/tmp</replaceText>
		<replaceText xpath="general/maxUploadSize">100</replaceText>
		<!-- <replaceText xpath="appHandler/luceneDir">${gn.files}/lucene</replaceText>
			<replaceText xpath="appHandler/dataDir">${gn.files}/data</replaceText> -->

		<!-- <replaceAtt xpath="appHandler/param[@name='geonetwork.dir']" attName="value"
			value="${gn.files}/data"/> -->

		<addXML xpath="appHandler">
			<param name="geonetwork.dir" value="${gn.path}/data" />
		</addXML>

		<!-- geonetwork.lucene.dir = {data}/index geonetwork.config.dir = {data}/config
			geonetwork.codeList.dir = {data}/config/codelist geonetwork.schema.dir {data}/config/schema_plugins
			geonetwork.data.dir {data}/data/metadata_data geonetwork.svn.dir {data}/data/metadata_subversion
			geonetwork.resources.dir {data}/data/resources -->

		<replaceXML xpath="resources">
			<resource enabled="true">
				<name>main-db</name>
				<provider>jeeves.resources.dbms.ApacheDBCPool</provider>
				<config>
					<user>${db.user}</user>
					<password>${db.pass}</password>
					<driver>org.postgresql.Driver</driver>
					<url>jdbc:postgresql://${db.path}</url>
					<poolSize>10</poolSize>
					<validationQuery>SELECT 1</validationQuery>
				</config>
			</resource>
		</replaceXML>

	</file>

	<file name=".*/WEB-INF/config-metadata.xml">
		<addXML xpath="services">
			<service name="metadata.privileges">
				<class name=".services.metadata.GetAdminOper"/>
			</service>
		</addXML>
		<addXML xpath="services">
			<service name="xml.metadata.info">
				<class name=".services.metadata.Info"/>
			</service>
		</addXML>
		<addXML xpath="services">
			<service name="logout.geodatase">
			</service>
		</addXML>
	</file>

	<file name=".*/WEB-INF/config-gui.xml">
	    <replaceXML xpath="languages">
			<eng/>
			<swe/>
		</replaceXML>

		<replaceXML xpath="map/proj">
			<crs code="EPSG:4326" default="0" edit="0"/><!-- WGS84 is mandatory because ISO store it by default in LatLong-->
            <crs code="EPSG:3006" default="1" edit="0" def="+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs" />
		</replaceXML>

		<replaceText xpath="map/osm_map">false</replaceText>


       <removeXML xpath="mapSearch" />
       <removeXML xpath="mapViewer" />

       <addXML xpath="">
			<mapSearch options="{projection: 'EPSG:3006', maxExtent: new OpenLayers.Bounds(200000,6100000,1000000,7700000), maxResolution:16000.00001, units: 'm', restrictedExtent: new OpenLayers.Bounds(200000,6100000,1000000,7700000)}" >
              <layers>
                 <layer server="${context.path}${bgproxy.urlpattern}"
                   tocName="Topografisk webbkarta"
                   params="{layers: 'topowebbkartan', format: 'image/png', EXCEPTIONS:'application/vnd.ogc.se_xml'}"
                   options="{isBaseLayer: true, singleTile: true}" />
              </layers>
            </mapSearch>
	   </addXML>

		<addXML xpath="">
			<mapViewer options="{projection: 'EPSG:3006', size: new OpenLayers.Size({w:200, h:400}), maxExtent: new OpenLayers.Bounds(200000,6100000,1000000,7700000), units: 'm', restrictedExtent: new OpenLayers.Bounds(200000,6100000,1000000,7700000)}" >
		        <layers>
		          <layer server="${context.path}${bgproxy.urlpattern}"
		            tocName="Topografisk webbkarta"
		            params="{layers: 'topowebbkartan', format: 'image/png', EXCEPTIONS:'application/vnd.ogc.se_xml'}"
		            options="{singleTile: true, isBaseLayer: true, noLegend: true, resolutions:[4480.20927,4340.202731,4200.196191,2800.130794,1400.065397,840.0392382,280.0130794,210.0098096,140.0065397,70.00326985,28.00130794,14.00065397,7.000326985,2.800130794,1.400065397], maxResolution:4200.196191}" />
		        </layers>
		        <scales values="[]" />

		        <proj>
		            <crs code="EPSG:3006" default="1" def="+proj=utm +zone=33 +ellps=GRS80 +towgs84=0,0,0,0,0,0,0 +units=m +no_defs" name="SWEREF99 TM" />
		        </proj>
		        <servers>
		        </servers>
		    </mapViewer>
		</addXML>
	</file>

	<spring>
		<addInterceptUrl bean="overridefilterSecurityInterceptor" pattern="/srv/[a-z]{2,3}/metadata.privileges!?.*" access="hasRole('Administrator')"/>
		<addInterceptUrl bean="overridefilterSecurityInterceptor" pattern="/srv/[a-z]{2,3}/xml.metadata.info!?.*" access="hasRole('Administrator')"/>
        <addInterceptUrl bean="overridefilterSecurityInterceptor" pattern="/srv/[a-z]{2,3}/login.form!?.*" access="denyAll"/>

		<!-- Deny all pdf requests -->
		<addInterceptUrl bean="overridefilterSecurityInterceptor" pattern=".*pdf.*!?.*" access="denyAll"/>

		<addInterceptUrl bean="overridefilterSecurityInterceptor" pattern="/srv/[a-z]{2,3}/user.pwedit!?.*" access="denyAll"/>
		<addInterceptUrl bean="overridefilterSecurityInterceptor" pattern="/srv/[a-z]{2,3}/user.pwupdate!?.*" access="denyAll"/>
		<addInterceptUrl bean="overridefilterSecurityInterceptor" pattern="/srv/[a-z]{2,3}/user.infoedit!?.*" access="denyAll"/>
		<addInterceptUrl bean="overridefilterSecurityInterceptor" pattern="/srv/[a-z]{2,3}/user.infoupdate!?.*" access="denyAll"/>

	</spring>

	<logging>
		<logFile>/WEB-INF/log4j.cfg</logFile>
		<logFile>/WEB-INF/lantmateriet-log4j.cfg</logFile>
	</logging>

</overrides>
